<% if @prev.nil? %>
  $('#prev').html('');
<% else %>
  $('#prev').html('<%= link_to(image_tag(@prev.image.url(:thumbnail), :border => 0, :title => "Previous photo"), {:action => :show, :id => @prev}, {:remote => true, :id => 'prevLink'}) %>');
<% end %>
$('#photo').html('<%= link_to(image_tag(@photo.image.url(:medium), :border => 0, :title => @photo.display_tags, :id => "display_photo_#{@photo.id}"), @photo.image.url) %>');
<% if @next.nil? %>
  $('#next').html('');
<% else %>
  $('#next').html('<%= link_to(image_tag(@next.image.url(:thumbnail), :border => 0, :title => "Next photo"), {:action => :show, :id => @next}, {:remote => true, :id => 'nextLink'}) %>');
<% end %>
$('#footer').html('<div id="display_tags"><%= @photo.display_tags %></div><%= @photo.taken_at.strftime('%Y-%m-%d %H:%M:%S (%a)') %><br/>  <%= link_to "Slideshow", :action => :slideshow, :id => @photo.id %> <%= link_to "Edit", :action => :edit, :id => @photo.id %>');
$('#stars').html('<div id="stars"></div>');

$(function() {
    $('#stars').raty({
      half: true,
      path: "/images/",
      <% unless @photo.stars.nil? %>
        start: <%= @photo.stars %>,
      <% end %>
      click: function(score) {
        $.get("/photos/<%=@photo.id%>/stars", {stars: score})
      }
    });

    $('#display_tags').editable("/photos/<%= @photo.id %>/update_tags",
      { tooltip: 'Click to edit..',
        type: 'autocomplete',
        onblur: "submit",
        callback: function(value, settings) {
          $.get("/photos/<%=@photo.id%>/update_tag_display", {
            old_tags: $("#display_photo_<%=@photo.id%>").attr('title')
          });
        },
autocomplete: {
          minLength: 2,
          source: "/tags/complete_tag",
          focus: function() {
            return false;
          },
          select: selectTag
        }
      });
  })

jQuery(document).trigger('reveal.facebox');
